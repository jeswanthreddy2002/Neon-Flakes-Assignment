{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Jaswanth Reddy\\\\Downloads\\\\upload-files-cloudinary-mern-main\\\\upload-files-cloudinary-mern-main\\\\client\\\\src\\\\components\\\\SecureUpload.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from \"react-router-dom\";\nimport { ThreeDots } from 'react-loader-spinner';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SecureUpload = () => {\n  _s();\n  const [img, setImg] = useState(null);\n  const [video, setVideo] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const navigate = useNavigate();\n  const uploadFile = async (type, timestamp, signature) => {\n    const folder = type === 'image' ? 'images' : 'videos';\n    const data = new FormData();\n    data.append(\"file\", type === 'image' ? img : video);\n    data.append(\"timestamp\", timestamp);\n    data.append(\"signature\", signature);\n    data.append(\"api_key\", process.env.REACT_APP_CLOUDINARY_API_KEY);\n    data.append(\"folder\", folder);\n    try {\n      let cloudName = process.env.REACT_APP_CLOUDINARY_CLOUD_NAME;\n      let resourceType = type === 'image' ? 'image' : 'video';\n      let api = `https://api.cloudinary.com/v1_1/${cloudName}/${resourceType}/upload`;\n      const res = await axios.post(api, data);\n      const {\n        secure_url\n      } = res.data;\n      console.log(secure_url);\n      return secure_url;\n    } catch (error) {\n      console.error(error);\n    }\n  };\n  const getSignatureForUpload = async folder => {\n    try {\n      const res = await axios.post(`${process.env.REACT_APP_BACKEND_BASEURL}/api/sign-upload`, {\n        folder\n      });\n      return res.data;\n    } catch (error) {\n      console.error(error);\n    }\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    try {\n      setLoading(true);\n\n      // Get signature for Image upload\n      const {\n        timestamp: imgTimestamp,\n        signature: imgSignature\n      } = await getSignatureForUpload('images');\n\n      // Get signature for video upload\n      const {\n        timestamp: videoTimestamp,\n        signature: videoSignature\n      } = await getSignatureForUpload('videos');\n\n      // Upload image file\n      const imgUrl = await uploadFile('image', imgTimestamp, imgSignature);\n\n      // Upload video file\n      const videoUrl = await uploadFile('video', videoTimestamp, videoSignature);\n\n      // Send backend api request\n      await axios.post(`${process.env.REACT_APP_BACKEND_BASEURL}/api/videos`, {\n        imgUrl,\n        videoUrl\n      });\n\n      // Reset states \n      setImg(null);\n      setVideo(null);\n      console.log(\"File upload success!\");\n      setLoading(false);\n      navigate(\"/\");\n    } catch (error) {\n      console.error(error);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"video\",\n          children: \"Video:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          accept: \"video/*\",\n          id: \"video\",\n          onChange: e => setVideo(prev => e.target.files[0])\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"img\",\n          children: \"Image:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          accept: \"image/*\",\n          id: \"img\",\n          onChange: e => setImg(prev => e.target.files[0])\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        children: \"Upload\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, this), loading && /*#__PURE__*/_jsxDEV(ThreeDots, {\n      height: \"80\",\n      width: \"80\",\n      radius: \"9\",\n      color: \"#4fa94d\",\n      ariaLabel: \"three-dots-loading\",\n      wrapperStyle: {},\n      wrapperClassName: \"\",\n      visible: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 20\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 81,\n    columnNumber: 5\n  }, this);\n};\n_s(SecureUpload, \"Rx2Q6FoJcf5fKsjM9tKglCn1my0=\", false, function () {\n  return [useNavigate];\n});\n_c = SecureUpload;\nexport default SecureUpload;\nvar _c;\n$RefreshReg$(_c, \"SecureUpload\");","map":{"version":3,"names":["React","useState","axios","useNavigate","ThreeDots","jsxDEV","_jsxDEV","SecureUpload","_s","img","setImg","video","setVideo","loading","setLoading","navigate","uploadFile","type","timestamp","signature","folder","data","FormData","append","process","env","REACT_APP_CLOUDINARY_API_KEY","cloudName","REACT_APP_CLOUDINARY_CLOUD_NAME","resourceType","api","res","post","secure_url","console","log","error","getSignatureForUpload","REACT_APP_BACKEND_BASEURL","handleSubmit","e","preventDefault","imgTimestamp","imgSignature","videoTimestamp","videoSignature","imgUrl","videoUrl","children","onSubmit","htmlFor","fileName","_jsxFileName","lineNumber","columnNumber","accept","id","onChange","prev","target","files","height","width","radius","color","ariaLabel","wrapperStyle","wrapperClassName","visible","_c","$RefreshReg$"],"sources":["C:/Users/Jaswanth Reddy/Downloads/upload-files-cloudinary-mern-main/upload-files-cloudinary-mern-main/client/src/components/SecureUpload.jsx"],"sourcesContent":["import React, { useState } from 'react'\nimport axios from 'axios';\nimport { useNavigate } from \"react-router-dom\";\nimport { ThreeDots } from 'react-loader-spinner'\n\nconst SecureUpload = () => {\n\n  const [img, setImg] = useState(null);\n  const [video, setVideo] = useState(null);\n  const [loading, setLoading] = useState(false);\n\n  const navigate = useNavigate();\n\n  const uploadFile = async (type, timestamp, signature) => {\n\n    const folder = type === 'image' ? 'images' : 'videos';\n\n    const data = new FormData();\n    data.append(\"file\", type === 'image' ? img : video);\n    data.append(\"timestamp\", timestamp);\n    data.append(\"signature\", signature);\n    data.append(\"api_key\", process.env.REACT_APP_CLOUDINARY_API_KEY);\n    data.append(\"folder\", folder);\n\n    try {\n      let cloudName = process.env.REACT_APP_CLOUDINARY_CLOUD_NAME;\n      let resourceType = type === 'image' ? 'image' : 'video';\n      let api = `https://api.cloudinary.com/v1_1/${cloudName}/${resourceType}/upload`;\n\n      const res = await axios.post(api, data);\n      const { secure_url } = res.data;\n      console.log(secure_url);\n      return secure_url;\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  const getSignatureForUpload = async (folder) => {\n    try {\n      const res = await axios.post(`${process.env.REACT_APP_BACKEND_BASEURL}/api/sign-upload`, { folder });\n      return res.data;\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    try {\n      setLoading(true);\n\n      // Get signature for Image upload\n      const { timestamp: imgTimestamp, signature: imgSignature } = await getSignatureForUpload('images');\n\n      // Get signature for video upload\n      const { timestamp: videoTimestamp, signature: videoSignature } = await getSignatureForUpload('videos');\n\n      // Upload image file\n      const imgUrl = await uploadFile('image', imgTimestamp, imgSignature);\n\n      // Upload video file\n      const videoUrl = await uploadFile('video', videoTimestamp, videoSignature);\n\n      // Send backend api request\n      await axios.post(`${process.env.REACT_APP_BACKEND_BASEURL}/api/videos`, { imgUrl, videoUrl });\n\n      // Reset states \n      setImg(null);\n      setVideo(null);\n\n      console.log(\"File upload success!\");\n      setLoading(false);\n      navigate(\"/\")\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  return (\n    <div>\n      <form onSubmit={handleSubmit}>\n        <div>\n          <label htmlFor=\"video\">Video:</label>\n          <br />\n          <input\n            type=\"file\"\n            accept=\"video/*\"\n            id=\"video\"\n            onChange={(e) => setVideo((prev) => e.target.files[0])}\n          />\n        </div>\n        <br />\n        <div>\n          <label htmlFor=\"img\">Image:</label>\n          <br />\n          <input\n            type=\"file\"\n            accept=\"image/*\"\n            id=\"img\"\n            onChange={(e) => setImg((prev) => e.target.files[0])}\n          />\n        </div>\n        <br />\n        <button type=\"submit\">Upload</button>\n      </form>\n\n      {\n        loading && <ThreeDots\n          height=\"80\"\n          width=\"80\"\n          radius=\"9\"\n          color=\"#4fa94d\"\n          ariaLabel=\"three-dots-loading\"\n          wrapperStyle={{}}\n          wrapperClassName=\"\"\n          visible={true}\n        />\n      }\n    </div>\n\n\n  )\n}\n\nexport default SecureUpload"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}